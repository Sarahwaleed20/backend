const sqlite3 = require('sqlite3').verbose();

const db = new sqlite3.Database('expenses.db', (err) => {
  if (err) {
    console.error('Error opening database:', err.message);
  } else {
    console.log('Connected to SQLite database.');
  }
});

const createUserTable = `
  CREATE TABLE IF NOT EXISTS USER (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    EMAIL TEXT UNIQUE NOT NULL,
    PASSWORD TEXT NOT NULL,
    ROLE TEXT NOT NULL
  )
`;

const createExpensesTable = `
  CREATE TABLE IF NOT EXISTS EXPENSES (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INTEGER NOT NULL,
    CATEGORY_ID INTEGER,
    AMOUNT REAL NOT NULL,
    DATE TEXT NOT NULL,
    DESCRIPTION TEXT,
    FOREIGN KEY(USER_ID) REFERENCES USER(ID),
    FOREIGN KEY(CATEGORY_ID) REFERENCES CATEGORY(ID)
  )
`;

const createCategoryTable = `
  CREATE TABLE IF NOT EXISTS CATEGORY (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INTEGER NOT NULL,
    NAME TEXT NOT NULL,
    DESCRIPTION TEXT,
    CREATED_AT TEXT NOT NULL,
    FOREIGN KEY(USER_ID) REFERENCES USER(ID)
  )
`;

const createBudgetTable = `
  CREATE TABLE IF NOT EXISTS BUDGET (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INTEGER NOT NULL,
    CATEGORY_ID INTEGER,
    AMOUNT REAL NOT NULL,
    START_DATE TEXT NOT NULL,
    END_DATE TEXT NOT NULL,
    CREATED_AT TEXT NOT NULL,
    FOREIGN KEY(USER_ID) REFERENCES USER(ID),
    FOREIGN KEY(CATEGORY_ID) REFERENCES CATEGORY(ID)
  )
`;
const createGuardianshipTable = `
  CREATE TABLE IF NOT EXISTS GUARDIANSHIP (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    GUARDIAN_ID INTEGER NOT NULL,
    CHILD_ID INTEGER NOT NULL,
    FOREIGN KEY(GUARDIAN_ID) REFERENCES USER(ID),
    FOREIGN KEY(CHILD_ID) REFERENCES USER(ID)
  )
`;

module.exports = {
  db,
  createUserTable,
  createExpensesTable,
  createCategoryTable,
  createBudgetTable,
  createGuardianshipTable
};